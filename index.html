<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>Phaser - Making your first game, part 2</title>
	<script src="_site/js/jquery-2.0.3.min.js" type="text/javascript"></script>
    <script src="_site/js/phaser.js" type="text/javascript"></script>
    </head>

    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update  });





function preload() {

    
	game.load.spritesheet('man', 'assets/man.png', 64, 64, 19);
	game.load.image('earth', 'assets/earth.png');
	game.load.image('tree', 'assets/tree.png');
	
}

var land;
var hero;
var cursors;
var trees;



function create() {

	 //  Resize our game world to be a 2000 x 2000 square
    game.world.setBounds(-1000, -1000, 2000, 2000);
	
	//Add earth tiled scrolling background
    land = game.add.tileSprite(0, 0, 800, 600, 'earth');
    land.fixedToCamera = true;	
	
	//Add hero
	hero = game.add.sprite(0, 0, 'man');
	hero.animations.add('left', [12, 10, 11, 13], 10, true);
	hero.animations.add('right', [18,15,16,17], 10, true);
	hero.animations.add('down', [0, 1, 3, 4], 10, true);
	hero.animations.add('up', [5,6,8,9], 10, true);
	
	
	
	hero.bringToTop();
	game.camera.follow(hero);
    game.camera.deadzone = new Phaser.Rectangle(150, 150, 500, 300);
    game.camera.focusOnXY(0, 0);
	
	// Some random trees
	trees = game.add.group();
	   
	
	
	for (var i = 0; i < 120; i++)
	{
		var x = game.world.randomX;
		var y = game.world.randomY;
		//Create a tree inside of the 'tree' group
		var tree = trees.create(x, y, 'tree');
		tree.body.immovable = true;
		
	}
	
	// Controls
	cursors = game.input.keyboard.createCursorKeys();
	

	
	
}

function update() {

	
	game.physics.overlap(hero, null, this);
	game.physics.collide(hero, trees, null, this);
	
	land.tilePosition.x = -game.camera.x;
    land.tilePosition.y = -game.camera.y;
	
	// Reset the players velocity (movement)
	hero.body.velocity.x = 0;
	hero.body.velocity.y = 0;
	
	if (cursors.left.isDown)
	{
		// Move to the left
		hero.body.velocity.x = -150;
		
		hero.animations.play('left');
	}
	else if (cursors.right.isDown)
	{
		//Move to the right
		hero.body.velocity.x = 150;
		
		hero.animations.play('right');
	}
	else if (cursors.down.isDown)
	{
		//Move down
		hero.body.velocity.y = 150;
		
		hero.animations.play('down');
	}
	else if (cursors.up.isDown)
	{
		//Move up
		hero.body.velocity.y = -150;
		
		hero.animations.play('up');
	}
	else
	{
		//Stand still
		hero.animations.stop();
		
		hero.frame = 2;
	}
	

	

}

</script>

</body>
</html>